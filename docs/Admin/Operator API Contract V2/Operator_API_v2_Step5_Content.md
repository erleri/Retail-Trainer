# Operator Console API Contract v2 — Step 5  
## Content Management API v2  
### (Study Materials · Auto-Module Generation · Quiz Builder · File Storage)

Status: FINAL — Defines the complete content ingestion, transformation, quiz-authoring, and delivery pipeline for Retail AI Trainer.

---

# 0. 목적 (Purpose)

Content Management API v2는 다음을 담당한다:

1. **학습 자료(Study Material) 업로드 및 메타데이터 관리**  
2. **AI 기반 콘텐츠 변환(Training Module 자동 생성)**  
3. **퀴즈 생성(자동 생성 + 수동 편집) 엔진 관리**  
4. **모바일 학습 모듈(Study → Quiz)와 연계되는 데이터 구조 제공**  
5. **콘텐츠 파일 스토리지 및 콘텐츠 → 시나리오·미션 맵핑**

Content API는 SalesLab · Gamification · Mission Engine의 입력으로 사용되기 때문에  
모든 엔진에서 **동일한 구조로 조회 가능한 API 규격**이 필요하다.

---

# 1. Study Material Object

```json
{
  "materialId": "string",
  "title": "string",
  "description": "string",
  "type": "pdf | video | link | text | image",
  "category": "product | sales_skill | objection_handling | etc",
  "tags": ["OLED", "Upsell"],

  "file": {
    "fileId": "string",
    "fileName": "string",
    "fileType": "application/pdf",
    "fileSize": 2043302,
    "storageUrl": "https://..."
  },

  "autoGeneratedModule": {
    "moduleId": "string",
    "status": "pending | completed | failed",
    "sections": []
  },

  "createdAt": 0,
  "updatedAt": 0,
  "scope": "BR"
}
```

---

# 2. Study Material CRUD API

## 2.1 Create  
`POST /operator/content/material`

Request:
```json
{
  "title": "OLED Upsell Guide",
  "description": "Tech spec + talking points",
  "type": "pdf",
  "category": "product",
  "tags": ["oled","upsell"],
  "scope": "BR"
}
```

---

## 2.2 Upload File  
`POST /operator/content/material/{materialId}/file`

Multipart form:
- file  
- optional metadata  

Response:
```json
{
  "fileId": "file_0441",
  "storageUrl": "https://..."
}
```

---

## 2.3 Get Material  
`GET /operator/content/material/{materialId}`

---

## 2.4 Update Metadata  
`PATCH /operator/content/material/{materialId}`

---

## 2.5 Delete Material  
`DELETE /operator/content/material/{materialId}`  
파일은 스토리지 정책에 따라 soft-delete 또는 hard-delete 가능.

---

# 3. AI 콘텐츠 변환 (Training Module Generation)

SalesLab의 모바일 학습 모듈을 자동 생성.

## 3.1 Generate Module  
`POST /operator/content/material/{materialId}/generate-module`

Request:
```json
{
  "preset": "standard | sales_skill | product_focus",
  "language": "en"
}
```

Response:
```json
{
  "moduleId": "module_3321",
  "status": "pending"
}
```

---

## 3.2 Get Module  
`GET /operator/content/module/{moduleId}`

Module 구조:
```json
{
  "moduleId": "string",
  "sections": [
    {
      "title": "What is OLED?",
      "body": "OLED creates light at pixel level...",
      "media": [
        { "type": "image", "url": "..." }
      ]
    }
  ],
  "summary": "OLED key advantages...",
  "createdAt": 0
}
```

---

## 3.3 Regenerate Module  
`POST /operator/content/module/{moduleId}/regenerate`

---

## 3.4 Delete Module  
`DELETE /operator/content/module/{moduleId}`

---

# 4. Quiz Management API  
자동 생성 + 수동 편집 가능한 구조.

---

## 4.1 Quiz Object

```json
{
  "quizId": "string",
  "materialId": "string",
  "questions": [
    {
      "questionId": "string",
      "type": "mcq | true_false",
      "question": "string",
      "options": ["A","B","C"],
      "answer": 1,
      "explanation": "OLED uses self-lit pixels..."
    }
  ],
  "difficulty": 2,
  "tags": ["oled","brightness"],
  "createdAt": 0
}
```

---

## 4.2 Create Quiz  
`POST /operator/content/quiz`

---

## 4.3 Auto-generate Quiz  
`POST /operator/content/material/{materialId}/generate-quiz`

Request:
```json
{
  "numQuestions": 5,
  "difficulty": 2
}
```

---

## 4.4 Update Quiz  
`PATCH /operator/content/quiz/{quizId}`

---

## 4.5 Delete Quiz  
`DELETE /operator/content/quiz/{quizId}`

---

# 5. Content → Scenario / Mission Mapping API

Scenario Stage 끝에서 "추천 학습" 기능 제공을 위해 필요.

## Set Mapping  
`POST /operator/content/mapping`

Request:
```json
{
  "materialId": "mat_001",
  "linkedTo": {
    "scenarioId": "sc_003",
    "stageId": "stage_12"
  }
}
```

---

## Get Mapping  
`GET /operator/content/mapping/{materialId}`

---

# 6. Search & Filter API for Console

`GET /operator/content/search`

Query:
```
?type=pdf  
?category=product  
?tag=oled  
?scope=BR  
```

---

# 7. Mobile Learning Delivery API (Read-Only)

콘텐츠 + 모듈 + 퀴즈를 학습자 앱으로 전달.

## 7.1 Get Study Module  
`GET /operator/learner/content/module/{moduleId}`

## 7.2 Start Quiz Session  
`POST /operator/learner/quiz/{quizId}/start`

Response:
```json
{
  "sessionId": "quiz_sess_244",
  "questions": [...]
}
```

---

## 7.3 Submit Quiz Answer  
`POST /operator/learner/quiz/{sessionId}/answer`

Request:
```json
{
  "questionId": "q3",
  "selected": 2
}
```

Response:
```json
{
  "correct": false,
  "correctAnswer": 1,
  "explanation": "OLED pixels turn off fully..."
}
```

퀴즈 피드백 구조는 Gamification Engine과 연결됨.

---

# 8. Scope Enforcement

- BR Operator → BR 콘텐츠만 수정 가능  
- MX Operator → BR 콘텐츠 수정 불가  
- Admin → 전체 접근 가능

---

# 9. Hot Reload (선택적)

Content 변경은 엔진에 강제 반영할 필요는 없지만  
Gamification/Mission/Insights에서 추천 로직이 바뀌므로  
핵심 학습 모듈 변경 시 Hot Reload 권장.

```
POST /operator/ops/hot-reload
{
  "type": "content",
  "targetId": "material_001"
}
```

---

# 10. Notes for DX & AG

- 콘텐츠 변환은 AG가 수행하지만 **콘텐츠 구조/필드를 직접 수정할 권한 없음**  
- 업로드 파일은 Operator가 업로드 → AI가 처리 → 모듈·퀴즈 생성  
- 학습 모듈은 Scenario/Mission/Insights 추천 시스템과 통합  
- 퀴즈 정답/풀이 결과는 User Performance Monitor API에서 기록됨

---

# END — Step 5 (Content Management API v2)
